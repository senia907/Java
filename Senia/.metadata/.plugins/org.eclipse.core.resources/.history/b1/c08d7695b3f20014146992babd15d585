package view;
import java.io.BufferedInputStream;
import java.io.BufferedOutputStream;
import java.io.BufferedReader;
import java.io.ByteArrayInputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.ObjectOutputStream;
import java.io.OutputStream;
import java.util.HashMap;
import java.util.zip.GZIPInputStream;
import java.util.zip.GZIPOutputStream;

import compression_algorithms.Compressor;
import compression_algorithms.HuffmanAlg;
import compression_algorithms.WordDictionary;
import compression_algorithms.ZippedDir;

/**
* The UserCommands class having the UserCommands as a Hashmap of a String and a Command.
* Used by the CLI for setting and calling the possible commands.
* @author  Senia Kalma
* @since   4/5/2015
*/
public class UserCommands {
	
	private HashMap<String, Command> commands = new HashMap<String,Command>();
	
	public UserCommands(HashMap<String, Command> commands) {
		super();
		this.commands = commands;
	}

	 public void put(String string, Command command) {
		  commands.put(string, command);
	}
	public void clear(){
		commands.clear();
	}
	
	public UserCommands()
	{
		commands.put("dir", new DirCommand());
		commands.put("zip", new ZipCommand());
		commands.put("unzip", new UnZipCommand());
		commands.put("huf", new HuffmanCommpress());
		commands.put("huf", new HuffmanDeCommpress());
		commands.put("dic", new DicCommand());
		commands.put("undic", new UnDicCommand());
		commands.put("size", new Size());
		// add the other commands to the hash map...
	}
	
	
	public Command selectCommand(String commandName){
		return commands.get(commandName);
	}
	
	
	private class DirCommand implements Command{
		@Override
		public void doCommand(String path) {
			File file = new File(path);
			if (file.isFile()){
				System.out.println(file);
			}
			else{
				for (File f : file.listFiles()){
					System.out.println(f);
				}
			}
		}
	}
	
	private class ZipCommand implements Command{
		@Override
		public void doCommand(String filePath) {
			BufferedInputStream in;
			GZIPOutputStream out;
			try {
				in=new BufferedInputStream(new FileInputStream(filePath));
				byte[] data=new byte[1000];
				out=new GZIPOutputStream(new FileOutputStream(filePath+".zip"));
				while((in.read(data))!=-1){
					out.write(data);
				}
				out.flush();
				out.close();
				in.close();
				System.out.println("Compressing Done");
			} catch (FileNotFoundException e) {
				e.printStackTrace();
			} catch (IOException e) {
			}
		}
	}
	
	private class UnZipCommand implements Command{
			@Override
			public void doCommand(String filePath) {
				BufferedOutputStream out;
				GZIPInputStream in;
				try {
					out=new BufferedOutputStream(new FileOutputStream(filePath.substring(0, filePath.length()-4)));
					byte[] data=new byte[1000];
					in=new GZIPInputStream(new FileInputStream(filePath));
					while((in.read(data))!=-1){
						out.write(data);
					}
					out.flush();
					out.close();
					in.close();
					System.out.println("DeCompressing Done");
				} catch (FileNotFoundException e) {
					e.printStackTrace();
				} catch (IOException e) {
				}
			}		
		}
	
	private class HuffmanCommpress implements Command{
		@Override
		public void doCommand(String filePath) {
			String str = filePath;
			Compressor huf = new HuffmanAlg();
			ByteArrayInputStream stream = new ByteArrayInputStream(str.getBytes());
			FileOutputStream file = null;
			try {
				file = (new FileOutputStream(filePath+".huf"));
			} catch (FileNotFoundException e) {
				e.printStackTrace();
			}
			huf.compress(stream,file);
		}
	}
	
	private class HuffmanDeCommpress implements Command{
		@Override
		public void doCommand(String filePath) {

		}
	}
	
	private class DicCommand implements Command{
		@Override
		public void doCommand(String fileName) {
		}		
	}
	
	private class UnDicCommand implements Command{
		@Override
		public void doCommand(String fileName) {			
			try {
				BufferedReader reader = new BufferedReader(new InputStreamReader(new FileInputStream(fileName)));
				
				StringBuffer buffer = new StringBuffer();
				String line;
				while ((line = reader.readLine()) != null){
					buffer.append(line);
				}
				String str = buffer.toString();		//Change to deCompress after part A done.
				WordDictionary myZip = new WordDictionary();
				//ZippedDir dict = myZip.compress(str); NOW 22:@2
				
				ObjectOutputStream out = new ObjectOutputStream(new FileOutputStream(fileName + ".dic"));
				//out.writeObject(dict);
				out.close();
				
				System.out.println("DeCompression finished");
				
			} catch (FileNotFoundException e) {
				e.printStackTrace();
			} catch (IOException e) {
				e.printStackTrace();
			}			
		}		
	}
	
	private class Size implements Command{

		@Override
		public void doCommand(String path) {
			BufferedInputStream in = null;
			try {
				in = new BufferedInputStream(new FileInputStream(path));
			} catch (FileNotFoundException e1) {
				e1.printStackTrace();
			}
			int size=0;
					try {
						while((in.read())!=-1){
							size++;
						}
					} catch (IOException e) {
						e.printStackTrace();
					}
			System.out.println("File size is: "+size);

		}
	}
	// all other commands...
}
